<div class="app-shell">
  <div class="shell-grid">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo-dot"></div>
        <div>
          <p class="eyebrow">Music</p>
          <h1>MusicApp</h1>
        </div>
      </div>
      <nav class="nav">
        <a routerLink="/home" routerLinkActive="active" class="nav-item">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3 9.5 12 3l9 6.5V21H3z" fill="currentColor" />
          </svg>
          Home
        </a>
        <a routerLink="/browse" routerLinkActive="active" class="nav-item">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4 5h16v2H4zm0 6h16v2H4zm0 6h10v2H4z" fill="currentColor" />
          </svg>
          Browse
        </a>
        <a routerLink="/library" routerLinkActive="active" class="nav-item">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 4h12v2H6zm-2 7h16v2H4zm4 7h8v2H8z" fill="currentColor" />
          </svg>
          Library
        </a>
      </nav>
      <div class="sidebar-section">
        <p class="eyebrow">Playlists</p>
        <div class="pill-group vertical">
          <span class="pill small">Daily Mix</span>
          <span class="pill small">Focus</span>
          <span class="pill small">Energy</span>
        </div>
      </div>
    </aside>

    <div class="content">
      <header class="top-bar">
        <button type="button" class="user-pill" (click)="toggleProfile()">
          <div class="avatar">D</div>
          <span>Profile</span>
        </button>
      </header>

      <main class="router-content">
        <router-outlet />
      </main>
    </div>

    <!-- Profile Panel -->
    @if (showProfile()) {
    <aside class="profile-panel">
      <div class="profile-header">
        <button type="button" class="close-btn" (click)="toggleProfile()">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M18 6 6 18M6 6l12 12" stroke="currentColor" stroke-width="2" />
          </svg>
        </button>
        <div class="profile-info">
          <div class="profile-avatar">D</div>
          <h2>Demo User</h2>
          <p class="meta">demo@musicapp.com</p>
        </div>
      </div>

      <div class="profile-content">
        <!-- Currently Playing -->
        @if (selected(); as song) {
        <section class="profile-section">
          <h3>Currently Playing</h3>
          <div class="now-playing-card">
            <div class="cover-art">{{ song.title.slice(0, 1) }}</div>
            <div class="song-info">
              <p class="title">{{ song.title }}</p>
              <p class="meta">{{ song.artist_name }}</p>
              <p class="meta">{{ song.album_title }}</p>
            </div>
            <button type="button" class="icon-btn" (click)="toggleLike(song.id)">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path [attr.fill]="song.is_liked ? 'currentColor' : 'none'"
                  [attr.stroke]="song.is_liked ? 'currentColor' : 'currentColor'"
                  [attr.stroke-width]="song.is_liked ? 0 : 1.5"
                  d="M12.1 8.64 12 8.77l-.1-.13C10.14 6.6 7.1 6.24 5.05 8.28c-2.06 2.04-2.06 5.36 0 7.4l6.23 6.23c.4.4 1.05.4 1.45 0l6.23-6.23c2.06-2.04 2.06-5.36 0-7.4-2.05-2.04-5.09-1.68-6.86.36Z" />
              </svg>
            </button>
          </div>
        </section>
        }

        <!-- Playlists -->
        <section class="profile-section">
          <h3>My Playlists</h3>
          @if (userPlaylists().length === 0) {
          <p class="empty">No playlists yet</p>
          } @else {
          <div class="playlist-grid">
            @for (playlist of userPlaylists(); track playlist.id) {
            <div class="playlist-card">
              <div class="playlist-cover">{{ playlist.name.slice(0, 1) }}</div>
              <p class="playlist-name">{{ playlist.name }}</p>
              <p class="meta">{{ playlist.description }}</p>
            </div>
            }
          </div>
          }
        </section>

        <!-- Liked Songs -->
        <section class="profile-section">
          <h3>Liked Songs <span class="count">{{ likedSongs().length }}</span></h3>
          @if (likedSongs().length === 0) {
          <p class="empty">No liked songs yet</p>
          } @else {
          <div class="liked-list">
            @for (song of likedSongs(); track song.id) {
            <button type="button" class="song-row" (click)="selectSong(song); toggleProfile()">
              <div class="song-details">
                <p class="title">{{ song.title }}</p>
                <p class="meta">{{ song.artist_name }} â€¢ {{ song.album_title }}</p>
              </div>
              <span class="length">{{ formatDuration(song.duration) }}</span>
            </button>
            }
          </div>
          }
        </section>
      </div>
    </aside>
    }
  </div>

  <footer class="player-bar">
    @if (selected(); as song) {
    <div class="player-meta">
      <div class="mini-cover">{{ song.title.slice(0, 1) }}</div>
      <div>
        <p class="title">{{ song.title }}</p>
        <p class="meta">{{ song.artist_name }}</p>
      </div>
    </div>
    <div class="player-controls">
      <button type="button" aria-label="Previous">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="m14 6-8 6 8 6V6zm2 0h2v12h-2V6z" />
        </svg>
      </button>
      <button type="button" class="play" aria-label="Play">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M8 5v14l11-7z" />
        </svg>
      </button>
      <button type="button" aria-label="Next">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="m10 6 8 6-8 6V6zm-2 0H6v12h2V6z" />
        </svg>
      </button>
    </div>
    <div class="player-extra">
      <button type="button" (click)="toggleLike(song.id)" aria-label="Toggle like">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path [attr.fill]="song.is_liked ? 'currentColor' : 'none'"
            [attr.stroke]="song.is_liked ? 'currentColor' : 'currentColor'"
            [attr.stroke-width]="song.is_liked ? 0 : 1.5"
            d="M12.1 8.64 12 8.77l-.1-.13C10.14 6.6 7.1 6.24 5.05 8.28c-2.06 2.04-2.06 5.36 0 7.4l6.23 6.23c.4.4 1.05.4 1.45 0l6.23-6.23c2.06-2.04 2.06-5.36 0-7.4-2.05-2.04-5.09-1.68-6.86.36Z" />
        </svg>
      </button>
    </div>
    }
  </footer>
</div>